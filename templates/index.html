<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üéüÔ∏è Ticket Monitor Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="logo" class="logo" />
        <h1>Ticket Monitor</h1>
        <p class="subtitle">Cute & dynamic musical watcher</p>
      </div>

      <div class="controls">
        <input id="search" placeholder="Buscar musical..." />
        <label class="auto-refresh" aria-live="polite">
          Auto-refresh:
          <button id="toggle-refresh" class="btn soft" type="button" aria-pressed="false">ON</button>
          <span id="ar-state" style="margin-left:8px;font-weight:600;color:#7b5a6f">ON</span>
        </label>
        <div class="last-checked">Last Checked: <span id="last-checked">--</span></div>
        <button id="test-telegram-btn" class="btn small">Test Telegram</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Hero / Slideshow -->
    <section class="hero">
      <div class="slideshow-container">
        <div class="slides">
          <div class="slide fade"><img src="{{ url_for('static', filename='BOM1.jpg') }}" alt="BOM1" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='BOM2.jpg') }}" alt="BOM2" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='BOM3.jpg') }}" alt="BOM3" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='BOM1.jpg') }}" alt="BOM4" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='BOM2.jpg') }}" alt="BOM5" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='BOM3.jpg') }}" alt="BOM6" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='BOM1.jpg') }}" alt="BOM7" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='AUDREY1.jpg') }}" alt="AUDREY1" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='HOUDINI1.jpg') }}" alt="HOUDINI1" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='LESMIS1.jpg') }}" alt="LESMIS1" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='LESMIS2.jpg') }}" alt="LESMIS2" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='LESMIS3.png') }}" alt="LESMIS3" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='LESMIS4.jpg') }}" alt="LESMIS4" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='LESMIS5.jpg') }}" alt="LESMIS5" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='LESMIS6.jpg') }}" alt="LESMIS6" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='LESMIS7.jpg') }}" alt="LESMIS7" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='WICKED1.jpg') }}" alt="WICKED1" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='WICKED2.jpg') }}" alt="WICKED2" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='WICKED3.jpg') }}" alt="WICKED3" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='WICKED4.jpg') }}" alt="WICKED4" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='WICKED5.jpg') }}" alt="WICKED5" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='WICKED6.jpg') }}" alt="WICKED6" class="slide-img"></div>
          <div class="slide fade"><img src="{{ url_for('static', filename='WICKED7.jpg') }}" alt="WICKED7" class="slide-img"></div>
        </div>
        <button class="slide-nav prev" onclick="plusSlides(-1)">&#10094;</button>
        <button class="slide-nav next" onclick="plusSlides(1)">&#10095;</button>
      </div>
      <div class="hero-cta">
        <h2>Keep an eye on ticket pages</h2>
        <p class="hero-sub">Live checks, friendly UI, and quick links to ticket pages.</p>
        <div class="hero-buttons">
          <a class="btn primary" href="#list">See musicals</a>
          <a class="btn ghost" href="#add">Add URL</a>
        </div>
      </div>
    </section>

    <!-- Decorative product-like cards (girly) -->
    <section class="promo-grid">
      <article class="promo-card">
        <div class="promo-badge">New</div>
        <h3>Featured Picks</h3>
        <p>Quick access to popular ticket pages ‚Äî pink, pretty, instant.</p>
        <a class="btn small" href="#list">Browse</a>
      </article>

      <article class="promo-card">
        <div class="promo-badge">Tips</div>
        <h3>Buying Guide</h3>
        <p>Save search filters, open favourite links fast.</p>
        <a class="btn small" href="#help">Learn</a>
      </article>

      <article class="promo-card">
        <div class="promo-badge">Glam</div>
        <h3>Notifications</h3>
        <p>Enable popups & Telegram to never miss a drop.</p>
        <a class="btn small" href="#notif">Setup</a>
      </article>
    </section>

    <!-- Table / List -->
    <section id="list" class="list-section">
      <table class="musicals-table" aria-label="Monitored musicals">
        <thead>
          <tr>
            <th aria-hidden="true"></th>
            <th>Musical</th>
            <th>URLs</th>
            <th>Cambios</th>
          </tr>
        </thead>
        <tbody id="table-body">
          <!-- populated by main.js -->
        </tbody>
      </table>

      <div id="no-data" class="no-data" hidden>No musicals yet ‚Äî add one ‚ú®</div>
    </section>
  </main>

  <div id="modal" class="modal" aria-hidden="true">
    <div id="modal-title"></div>
    <div id="modal-list"></div>
    <button id="modal-close" aria-label="Close">Close</button>
  </div>

  <footer class="footer">
    <small>Made with üíñ ‚Äî dynamic cute monitor</small>
  </footer>

  <div id="telegram-popup" class="notification-popup" role="dialog" aria-modal="true" aria-hidden="true" style="display:block;opacity:0;pointer-events:none;">
    <div>
      <strong class="np-title">√önete a nuestro Telegram</strong>
      <div class="np-body" style="margin-top:6px;font-weight:600">Recibe alertas y novedades en tiempo real.</div>
    </div>
    <div style="display:flex;gap:8px;margin-left:auto;align-items:center">
      <a id="telegram-join" class="btn primary" href="https://t.me/TheBookOfMormonTicketsbot" target="_blank" rel="noopener noreferrer" style="text-decoration:none;padding:8px 12px">Unirme</a>
      <button id="telegram-dismiss" class="btn ghost" style="padding:8px 10px">No, gracias</button>
    </div>
    <button class="np-close" aria-label="Cerrar" id="telegram-close" style="position:absolute;top:8px;right:10px;background:transparent;border:0;font-size:18px;color:var(--accent)">√ó</button>
  </div>

  <script id="initial-data" type="application/json">{{ (musicals | default([])) | tojson }}</script>
  <script>
    const INITIAL_MUSICALS = JSON.parse(document.getElementById('initial-data').textContent || '[]');
  </script>
  <!-- main script -->
  <script src="{{ url_for('static', filename='main.js') }}"></script>
  <script>
    // show Telegram popup on first visit (remember choice in localStorage)
    (function(){
      const KEY = 'telegramPopupSeen_v1';
      if (localStorage.getItem(KEY)) return;
      const popup = document.getElementById('telegram-popup');
      if (!popup) return;
      // show with small delay so it doesn't feel abrupt
      setTimeout(() => {
        popup.classList.add('show');
        popup.style.opacity = 1;
        popup.style.pointerEvents = 'auto';
        popup.setAttribute('aria-hidden','false');
      }, 700);

      function hideAndRemember() {
        try { localStorage.setItem(KEY, '1'); } catch(e){}
        popup.classList.remove('show');
        popup.style.opacity = 0;
        popup.style.pointerEvents = 'none';
        popup.setAttribute('aria-hidden','true');
      }

      document.getElementById('telegram-join').addEventListener('click', () => {
        hideAndRemember();
        // allow anchor to open in new tab (already target="_blank")
      });
      document.getElementById('telegram-dismiss').addEventListener('click', (e) => { e.preventDefault(); hideAndRemember(); });
      document.getElementById('telegram-close').addEventListener('click', (e) => { e.preventDefault(); hideAndRemember(); });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') hideAndRemember(); });
    })();
  </script>
  <script>
document.getElementById('test-telegram-btn').addEventListener('click', () => {
  fetch('/admin/test-telegram', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text: 'Prueba desde UI ‚Äî Ticket Monitor' })
  })
  .then(r => r.json())
  .then(j => alert('Telegram test: ' + (j.ok ? 'OK' : JSON.stringify(j))))
  .catch(e => alert('Error: ' + e));
});
</script>
</body>
</html>